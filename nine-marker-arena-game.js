const questions = [
  {
    "id": "posterAudience",
    "focus": "audience",
    "heading": "Evaluating a poster for its audience",
    "question": "A college has designed an A3 poster to promote an open evening for Year 11 pupils and their parents. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The poster includes several images and bright colours, which makes it look lively and eye-catching...",
        "commentary": "Superficial description with little evaluation."
      },
      {
        "band": 2,
        "text": "The poster is quite effective because it uses bright colours and a large heading...",
        "commentary": "Some strengths and weaknesses, limited reasoning."
      },
      {
        "band": 3,
        "text": "The poster makes a generally strong attempt to appeal to both Year 11 pupils and their parents...",
        "commentary": "Developed points linked to both audiences, balanced judgement."
      }
    ]
  },
  {
    "id": "moodboardGame",
    "focus": "preproduction",
    "heading": "Evaluating a mood board",
    "question": "A student created a mood board for a mobile platform game. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The mood board has a lot of pictures that relate to games, like characters jumping...",
        "commentary": "Mostly descriptive."
      },
      {
        "band": 2,
        "text": "The mood board gives a fairly good sense of a mobile platform game because it uses bright cartoon artwork...",
        "commentary": "Some reasoning but lacks depth."
      },
      {
        "band": 3,
        "text": "The mood board communicates several important aspects of the intended mobile platform game...",
        "commentary": "Clear links to brief, balanced evaluation."
      }
    ]
  },
  {
    "id": "distributionPlan",
    "focus": "distribution",
    "heading": "Evaluating a distribution plan",
    "question": "A client wants to promote a new revision website for GCSE students. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The plan uses posters, videos and social media, which are all good ways to promote a website...",
        "commentary": "Generic and repetitive."
      },
      {
        "band": 2,
        "text": "The distribution plan reaches students in a variety of ways. Posters in corridors will remind pupils...",
        "commentary": "Adequate explanation but limited depth."
      },
      {
        "band": 3,
        "text": "The plan is well suited to GCSE students because it combines repeated physical reminders with online promotion...",
        "commentary": "Detailed reasoning with balance."
      }
    ]
  },
  {
    "id": "legalEthical",
    "focus": "legal",
    "heading": "Legal and ethical issues",
    "question": "A charity is producing a short online video about cyberbullying. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The production team must think about copyright, data protection and making sure no one is upset...",
        "commentary": "Keywords without application."
      },
      {
        "band": 2,
        "text": "The video should avoid copyrighted music unless permission is given and follow data protection laws...",
        "commentary": "Some correct points but limited evaluation."
      },
      {
        "band": 3,
        "text": "Several legal and ethical issues require careful planning. Any music or images must be licensed...",
        "commentary": "Scenario-linked and justified."
      }
    ]
  },
  {
    "id": "workPlan",
    "focus": "preproduction",
    "heading": "Evaluating a work plan",
    "question": "A work plan for a radio advert lists tasks but no contingency time. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The work plan lists tasks like writing and editing, which shows the team what to do...",
        "commentary": "Descriptive, no evaluation."
      },
      {
        "band": 2,
        "text": "The work plan helps organise the advert because it sets tasks in order, but lacks contingency...",
        "commentary": "Some reasoning but incomplete judgement."
      },
      {
        "band": 3,
        "text": "The work plan provides a clear structure and useful milestones, but missing contingency is a key weakness...",
        "commentary": "Well reasoned with balanced conclusion."
      }
    ]
  },
  {
    "id": "fileFormatsMobileAdvert",
    "focus": "preproduction",
    "heading": "Evaluating file format choices",
    "question": "A designer is preparing images and audio for an online advert that will be shown on mobile devices. Evaluate how suitable the chosen file formats are. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "bandLabel": "Band 1 – weak / limited",
        "text": "The designer chose good file formats because they make the advert look professional. The images are saved in a high-quality format so they will appear clearly, and the audio is also stored in a format that works on phones. Using high-quality settings means the advert will not look blurred and the sound will be strong, which should impress the audience. The designer has used file types that people often use online, so they should work well on most devices. Overall, these choices show good planning because the advert will load with all its elements and nothing will be missing, so the project should work well.",
        "commentary": "Mentions quality vaguely, with no real understanding of compression, optimisation or suitability for mobile delivery."
      },
      {
        "band": 2,
        "bandLabel": "Band 2 – some development",
        "text": "The designer uses JPEG for images, which is suitable because it reduces file size for faster loading on mobile devices. MP3 audio is also widely supported and small enough for streaming. However, JPEG may lose some detail if compressed too much, and MP3 can create noticeable distortion for music. PNG could have been used for transparent logos, but it is not mentioned. The formats selected are mostly appropriate but the designer does not explain how different compression settings might affect the final advert. This makes the choices somewhat suitable but not fully considered.",
        "commentary": "Shows broadly correct ideas but has limited evaluation and only briefly considers the impact of the choices."
      },
      {
        "band": 3,
        "bandLabel": "Band 3 – well developed",
        "text": "The chosen formats are largely appropriate for delivering a smooth mobile advert. JPEG keeps image sizes low so pages load quickly on slower connections, while still maintaining enough detail for small screens when medium-level compression is applied. For assets requiring transparency, such as logos, PNG would help preserve sharp edges without introducing artefacts. MP3 works well for short voice-over clips as it compresses efficiently, but the designer should check bitrates so music elements remain clear. One potential issue is using very high-quality settings, which could slow loading rather than improve clarity. Overall, the formats support mobile delivery effectively, though a little more attention to specific compression settings could strengthen the choices.",
        "commentary": "Gives a balanced, scenario-linked evaluation that weighs performance against quality and suggests realistic improvements."
      }
    ]
  },
  {
    "id": "assetsMusicFestivalLeaflet",
    "focus": "preproduction",
    "heading": "Evaluating suitability of assets",
    "question": "A student is creating a printed leaflet to advertise a local music festival. They have gathered photos from friends’ social media accounts and a low-resolution logo from an old website. Evaluate how suitable these assets are. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "bandLabel": "Band 1 – weak / limited",
        "text": "The photos chosen show people enjoying music, which fits the idea of a festival. The logo is also included, so readers will know which event it is for. The colours in the images are bright, giving the leaflet a fun look. The assets seem good because they match the theme and make the leaflet eye-catching. Even if some images are slightly blurry or taken from social media, they still show the right idea. The designer has used what was available, so the assets should work fine for promoting the festival.",
        "commentary": "Focuses on surface meaning and appearance, ignoring print quality, resolution and copyright issues."
      },
      {
        "band": 2,
        "bandLabel": "Band 2 – some development",
        "text": "Some assets are suitable because the photos clearly relate to music events and create the right mood for a festival. However, most were taken from friends’ social media accounts, so permission might be an issue. The logo from the old website could appear pixelated if scaled up for print. The designer is using relevant imagery but may struggle with quality when printing at A5 size. Overall, the assets match the topic but need checking or replacing to avoid legal and technical issues.",
        "commentary": "Recognises legal and technical concerns but does not fully explore how they will affect the finished leaflet."
      },
      {
        "band": 3,
        "bandLabel": "Band 3 – well developed",
        "text": "Although the assets match the festival theme, several concerns affect their suitability for print. Social-media images often have heavy compression, meaning they may appear grainy when enlarged, which could reduce the leaflet’s professional look. Permission is also required from the photographer and any recognisable individuals. The low-resolution logo is likely to blur, weakening the festival’s branding. To improve the leaflet, the designer could request original high-resolution photos or use a vector version of the logo. Overall, the assets communicate the festival atmosphere well but are not fully appropriate for high-quality print without changes.",
        "commentary": "Links suitability to technical quality, legal permission and brand impact, with a clear, balanced judgement and practical suggestions."
      }
    ]
  },
  {
    "id": "scriptSportsDrinkAdvert",
    "focus": "preproduction",
    "heading": "Evaluating a TV advert script",
    "question": "A script has been written for a 30-second TV advert for a new sports drink. Evaluate how suitable the script is for its purpose and audience. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "bandLabel": "Band 1 – weak / limited",
        "text": "The script talks about the sports drink and shows people being active, which is good for the audience. There is dialogue and action that makes the advert exciting, and the message is clear that the drink gives energy. The scenes move quickly, so the audience will stay interested. The script also includes a slogan which will help people remember the product. Because everything is included in the script, it should work for a 30-second advert and appeal to sporty viewers.",
        "commentary": "Repeats simple ideas and assumes success without considering timing, structure or how well the script targets the audience."
      },
      {
        "band": 2,
        "bandLabel": "Band 2 – some development",
        "text": "The script uses short scenes of teenagers playing sport, which suits the target audience. It ends with a slogan and product shot, which is typical for adverts. However, the amount of dialogue may be difficult to fit into 30 seconds, and some descriptions are vague. The voice-over explains key benefits, but the script does not clearly show how each scene will transition, making pacing unclear. Overall, the script is suitable but may need editing to tighten the timing.",
        "commentary": "Identifies some strengths and a timing issue, but the evaluation of how well the script meets its purpose is limited."
      },
      {
        "band": 3,
        "bandLabel": "Band 3 – well developed",
        "text": "The script is generally well matched to a fast 30-second advert. Quick visual clips of different sports help attract teenage viewers, while the voice-over highlights key product benefits without slowing the pace. The dialogue is brief and placed around action shots so scenes remain clear. One potential issue is that three separate locations may still feel rushed, so the production team should check timings during the storyboard stage. The ending slogan and close-up product shot give the advert a clear message. Overall, the script communicates purpose effectively with only minor adjustments needed.",
        "commentary": "Analyses how script structure, visuals and timing support the purpose, and offers a realistic concern with a balanced overall judgement."
      }
    ]
  },
  {
    "id": "layoutFilmMagazineCover",
    "focus": "audience",
    "heading": "Evaluating a magazine cover layout",
    "question": "A magazine front cover for a film-review magazine aimed at young adults has been designed. Evaluate how effective the layout is in attracting the target audience. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "bandLabel": "Band 1 – weak / limited",
        "text": "The layout works because it uses a big picture in the centre and has text around it, which looks like a real magazine. The masthead is at the top, making it easy to see, and the cover lines tell readers about films. The colours are bold and eye-catching, which will appeal to people shopping. The layout follows a standard style, so it should attract the target audience because everything is clear and bright.",
        "commentary": "Simply points out standard features and assumes they are effective, without linking them to young adult needs or expectations."
      },
      {
        "band": 2,
        "bandLabel": "Band 2 – some development",
        "text": "The cover uses a large superhero image which suits young adults who enjoy action films. The masthead is bold, and the cover lines are placed neatly on either side. However, some text is quite small and may not stand out on a crowded shelf. The layout is visually appealing but could be improved with clearer spacing. Overall, it is effective but not outstanding.",
        "commentary": "Explains some layout choices and a weakness, but the discussion of how the layout attracts young adults is limited."
      },
      {
        "band": 3,
        "bandLabel": "Band 3 – well developed",
        "text": "The layout appeals to young adult film fans through a bold masthead and a dramatic central image that quickly communicates genre. Angled boxes and highlights around key cover lines help create energy while keeping the page organised. The topics—new releases, streaming picks and behind-the-scenes articles—match audience interests. A weaker area is a thin block of text near the bottom that may be hard to read at a distance. Adjusting the font weight or simplifying that section could improve clarity. Overall, the layout is engaging and mostly meets the expectations of a modern film magazine.",
        "commentary": "Links specific layout decisions to genre and target-audience interests, and offers a balanced judgement with a practical improvement."
      }
    ]
  },
  {
    "id": "purposeMessageCodingCampaign",
    "focus": "audience",
    "heading": "Evaluating purpose and message",
    "question": "A social media campaign has been created to encourage teenagers to join a local coding club. Evaluate how well the campaign meets its purpose and target audience. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "bandLabel": "Band 1 – weak / limited",
        "text": "The campaign uses social media, which is good because teenagers use it a lot. The images show people coding and having fun, so this will make teenagers want to join the club. The campaign has bright colours and emojis, which help the message stand out. The information is on the posts, so teens will know what to do. Overall, the campaign works well because it shows the message clearly.",
        "commentary": "Gives a basic positive opinion with little detail and no real evaluation of how clearly the purpose is communicated."
      },
      {
        "band": 2,
        "bandLabel": "Band 2 – some development",
        "text": "The campaign uses short videos and colourful posts, which suit teenage audiences. The clips show club members working on projects, which helps communicate the purpose. However, key details like meeting times and location appear only in small text on some posts, meaning viewers may miss important information. The campaign is creative but lacks consistency across all posts. It meets the purpose to some extent but could be improved.",
        "commentary": "Identifies strengths and weaknesses but does not fully explain how these affect the success of the campaign."
      },
      {
        "band": 3,
        "bandLabel": "Band 3 – well developed",
        "text": "The campaign mostly succeeds in encouraging teenagers to join the coding club. Short vertical videos show real activities, helping viewers picture what they would do at the club. Captions use casual language and benefits such as building skills and meeting new people, which match teenagers’ motivations. A clear call-to-action link makes sign-up easy. However, some posts don’t show meeting details, which could confuse first-time viewers. Adding the information consistently would strengthen the message. Overall, the campaign is persuasive and well aligned with the audience.",
        "commentary": "Evaluates how format, tone and calls-to-action support the purpose, noting a realistic weakness and offering a clear, balanced judgement."
      }
    ]
  },
  {
    "id": "storyboardCharity",
    "focus": "preproduction",
    "heading": "Evaluating a storyboard",
    "question": "A charity is producing an awareness video. Evaluate how effective the storyboard is. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The storyboard shows different scenes that explain the charity’s message. It has pictures in each frame, and there are arrows showing how the scenes move from one to another. The text underneath explains what is happening, which helps make the storyboard clear. The drawings also show different people, which is good because it makes the video more interesting. The storyboard includes everything needed, so the charity video will definitely work well and get the message across to the audience.",
        "commentary": "Descriptive, no judgement."
      },
      {
        "band": 2,
        "text": "The storyboard includes a good range of shots such as close-ups and mid-shots, which helps communicate emotion. The captions explain what will be said in the voice-over, although some frames have very little detail. The transitions between scenes are shown, but the pacing may be unclear because many frames contain similar actions. The storyboard gives the charity a general idea of the final video, but some panels would need more detail before filming.",
        "commentary": "Some analysis but limited."
      },
      {
        "band": 3,
        "text": "The storyboard broadly supports the charity’s aim by using close-ups to show individuals affected by the issue and wider shots to highlight community support. Captions outline the voice-over well, though a few frames lack specific directions for camera movement or on-screen text. The sequence flows logically, but one section involves three similar scenes that may slow the pace, so combining them could help sustain engagement. Overall, the storyboard communicates the message effectively while leaving a few production details to refine.",
        "commentary": "Balanced, purpose-linked."
      }
    ]
  },
  {
    "id": "colourTypographyWebsite",
    "focus": "design",
    "heading": "Evaluating colour and typography",
    "question": "A mock-up has been created for an educational website homepage. Evaluate the effectiveness of colour and typography. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The colours on the website mock-up look good because they are bright and stand out. The text is written in a clear font that people can read, and the headings are bigger than the paragraphs, which is normal for a website. The colours and fonts make the design nice to look at and help the audience understand the information. Overall, the colour and typography choices work well.",
        "commentary": "Pure description."
      },
      {
        "band": 2,
        "text": "The mock-up uses a blue and white colour scheme, which makes the website look professional. The main font is easy to read, although some parts of the text are a bit small. Headings are bold, but the contrast between the text and background is weak on some boxes. The design mostly suits an educational website but could be clearer in places. Overall, the choices are reasonable but not fully effective.",
        "commentary": "Attempts evaluation but shallow."
      },
      {
        "band": 3,
        "text": "The colour scheme creates a calm and trustworthy impression appropriate for an educational audience. Blue backgrounds with white text generally provide good contrast, although one lighter section reduces readability slightly. The sans-serif font supports clarity on screens, and the hierarchy between headings and body text is consistent, making navigation easier. A potential issue is that the call-to-action button blends in with other blue elements, so adjusting its hue would make it more noticeable. Overall, the typography and colours are mostly effective with minor refinements needed.",
        "commentary": "Balanced and linked to purpose."
      }
    ]
  },
  {
    "id": "riskAssessmentPhotography",
    "focus": "legal",
    "heading": "Evaluating a risk assessment",
    "question": "A student has created a risk assessment for an outdoor photography shoot. Evaluate how suitable it is. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The risk assessment lists hazards like tripping and bad weather, which is good because these are risks on a shoot. It also says that people should take care and wear protective clothing, which will help keep them safe. The document covers everything needed for a shoot, so it should prevent accidents and make sure everyone stays safe.",
        "commentary": "Very vague."
      },
      {
        "band": 2,
        "text": "The risk assessment identifies common hazards such as cables, tripods and uneven ground in the outdoor location. It includes basic controls like taping cables and reminding people to watch where they step. However, it does not mention who is responsible for each action or how risks will be monitored on the day. Overall, it is somewhat suitable but lacks detail to ensure the shoot runs smoothly.",
        "commentary": "Recognises omissions but shallow."
      },
      {
        "band": 3,
        "text": "The assessment identifies relevant hazards for an outdoor shoot, including unstable ground, changing weather and equipment obstructing paths. Control measures such as sandbagging tripods, checking weather updates and marking cable routes help reduce risk. A missing detail is allocating responsibility for each control, which could lead to confusion during the shoot. Emergency plans are mentioned but not clearly linked to specific hazards. Overall, the document is useful and mostly practical, though assigning responsibilities would make it more reliable.",
        "commentary": "Strong reasoning, balanced judgement."
      }
    ]
  },
  {
    "id": "homepageFilmReview",
    "focus": "design",
    "heading": "Evaluating a homepage mock-up",
    "question": "A homepage has been designed for a film‑review website aimed at young adults. Evaluate how effective the layout and design are. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The homepage shows lots of films, which is good for people who like movies. The images look exciting and the buttons are easy to see. The layout looks like a real website and the colours are bold. The homepage will make people want to click on the films because everything is eye-catching.",
        "commentary": "Descriptive, no UX consideration."
      },
      {
        "band": 2,
        "text": "The homepage uses a clean layout with featured films at the top, which suits film fans. The navigation bar is clear, although some menu items are close together. The text under each film image is small and may be difficult to read. The design works for young adults but could be more structured to guide users. Overall, it is effective but not outstanding.",
        "commentary": "Some reasoning but shallow."
      },
      {
        "band": 3,
        "text": "The homepage presents reviews in a way that suits young adults by using bold visuals and a simple navigation bar that groups content logically. Featured films at the top create a clear hierarchy and encourage exploration. However, some caption text is small, which may hinder readability on mobile devices. The colour scheme is consistent but could use stronger contrast on buttons to improve call‑to‑action visibility. Overall, the layout supports user navigation well with room for minor improvements.",
        "commentary": "Well reasoned, audience-aware."
      }
    ]
  },
  {
    "id": "accessibilityCampaign",
    "focus": "legal",
    "heading": "Evaluating inclusivity and accessibility",
    "question": "A digital campaign aims to be inclusive and accessible to a wide audience. Evaluate how effective it is. Rank the answers from strongest to weakest.",
    "answers": [
      {
        "band": 1,
        "text": "The campaign is inclusive because it shows different people and has colourful designs. The font is clear and the pictures look friendly, so everyone can understand the message. The campaign will reach lots of people because it uses the internet. Overall, it seems very inclusive.",
        "commentary": "Overgeneralised, no real accessibility awareness."
      },
      {
        "band": 2,
        "text": "The campaign includes diverse characters, which helps a wider audience feel represented. The text is readable, but the colour contrast in some areas may be difficult for people with visual impairments. Captions are used in one of the videos, but not all. The campaign is partly accessible but needs more consistency. It meets the brief to some extent.",
        "commentary": "Useful points but limited depth."
      },
      {
        "band": 3,
        "text": "The campaign attempts to be inclusive by featuring people of different backgrounds and using a friendly, approachable tone. Several posts include captions and alt‑text descriptions, which helps users with hearing or visual impairments. However, colour contrast varies across the designs, and one carousel post includes text embedded within images, making it harder for assistive technology to read. Adding consistent captions and ensuring WCAG‑compliant contrast levels would make the campaign more accessible overall. Even with these issues, the campaign communicates inclusivity reasonably well.",
        "commentary": "Balanced, accurate accessibility evaluation."
      }
    ]
  }
];

// ===== Game State =====
let allQuestions = questions;          // full bank
let activeQuestions = questions;       // filtered by focus
let currentIndex = 0;
let score = 0;

// ===== Shuffle Utility =====
function shuffle(arr){
  return arr
    .map(a => ({ sort: Math.random(), value: a }))
    .sort((a,b) => a.sort - b.sort)
    .map(a => a.value);
}

// ===== Render Question =====
function renderQuestion(){
  const q = activeQuestions[currentIndex];

  // Set question UI
  document.getElementById("questionHeading").innerText = q.heading;
  document.getElementById("questionText").innerText = q.question;

  const container = document.getElementById("answersContainer");
  container.innerHTML = "";

  const feedbackEl = document.getElementById("feedback");
  const explanationEl = document.getElementById("explanation");
  feedbackEl.innerText = "";
  explanationEl.innerHTML = "";
  explanationEl.classList.add("hidden");

  document.getElementById("questionNumber").innerText = currentIndex + 1;
  document.getElementById("questionTotal").innerText = activeQuestions.length;

  // Shuffle and create answer cards with Up/Down buttons
  const shuffled = shuffle(q.answers);

  shuffled.forEach(ans => {
    const card = document.createElement("div");
    card.className = "answer-card";
    card.dataset.band = ans.band;

    const inner = document.createElement("div");
    inner.className = "answer-card-inner";

    const textDiv = document.createElement("div");
    textDiv.className = "answer-text";
    textDiv.innerText = ans.text;

    const controls = document.createElement("div");
    controls.className = "ordering-controls";
    controls.innerHTML = `
      <button type="button" class="order-btn move-up" aria-label="Move answer up">▲</button>
      <button type="button" class="order-btn move-down" aria-label="Move answer down">▼</button>
    `;

    inner.appendChild(textDiv);
    inner.appendChild(controls);
    card.appendChild(inner);
    container.appendChild(card);
  });

  document.getElementById("checkRankingBtn").disabled = false;
  document.getElementById("nextQuestionBtn").disabled = true;
  document.getElementById("toggleExplanationBtn").disabled = true;
}

// ===== Check Order =====
function checkRanking(){
  const cards = Array.from(document.querySelectorAll(".answer-card"));
  if(cards.length < 3) return;

  const bands = cards.map(c => Number(c.dataset.band));
  let roundScore = 0;
  if(bands[0] === 3) roundScore++;
  if(bands[1] === 2) roundScore++;
  if(bands[2] === 1) roundScore++;

  score += roundScore;
  document.getElementById("scoreDisplay").innerText = score;

  const feedbackEl = document.getElementById("feedback");
  feedbackEl.innerText = `You scored ${roundScore} out of 3 on this ranking.`;

  const q = activeQuestions[currentIndex];
  let explanationHTML = "";
  q.answers
    .slice()
    .sort((a,b) => b.band - a.band)
    .forEach(a => {
      explanationHTML += `<p><strong>Band ${a.band}</strong>: ${a.commentary}</p>`;
    });

  const explanationEl = document.getElementById("explanation");
  explanationEl.innerHTML = explanationHTML;

  document.getElementById("checkRankingBtn").disabled = true;
  document.getElementById("nextQuestionBtn").disabled = false;
  document.getElementById("toggleExplanationBtn").disabled = false;
}

// ===== Toggle Examiner Commentary =====
function toggleExplanation(){
  const box = document.getElementById("explanation");
  box.classList.toggle("hidden");
}

// ===== Next Question =====
function nextQuestion(){
  currentIndex++;
  if(currentIndex >= activeQuestions.length){
    const totalPossible = activeQuestions.length * 3;
    document.body.innerHTML = `
      <div class="final-screen">
        <h1>9-Marker Arena Complete!</h1>
        <p>Your final score: <strong>${score}</strong> / ${totalPossible}</p>
      </div>
    `;
    return;
  }
  renderQuestion();
}

// ===== Start / New Game =====
function startArena(){
  const mode = document.getElementById("modeSelect").value;

  if(mode === "mixed"){
    activeQuestions = shuffle([...allQuestions]);
  } else {
    activeQuestions = shuffle(allQuestions.filter(q => q.focus === mode));
  }

  currentIndex = 0;
  score = 0;
  document.getElementById("scoreDisplay").innerText = "0";

  renderQuestion();
}

// ===== Wire up events once DOM is ready =====
window.addEventListener("DOMContentLoaded", () => {
  document.getElementById("newGameBtn").addEventListener("click", startArena);
  document.getElementById("checkRankingBtn").addEventListener("click", checkRanking);
  document.getElementById("nextQuestionBtn").addEventListener("click", nextQuestion);
  document.getElementById("toggleExplanationBtn").addEventListener("click", toggleExplanation);

  // Click-to-move ordering (▲ / ▼)
  const answersContainer = document.getElementById("answersContainer");
  answersContainer.addEventListener("click", (e) => {
    const up = e.target.closest(".move-up");
    const down = e.target.closest(".move-down");
    if (!up && !down) return;

    const card = e.target.closest(".answer-card");
    if (!card) return;
    const container = answersContainer;

    if (up) {
      const prev = card.previousElementSibling;
      if (prev) {
        container.insertBefore(card, prev);
      }
    } else if (down) {
      const next = card.nextElementSibling;
      if (next) {
        container.insertBefore(card, next.nextSibling);
      }
    }
  });
});
